from datetime import datetime, timedelta
import pytz

def get_kst_now():
    return datetime.utcnow().replace(tzinfo=pytz.utc).astimezone(pytz.timezone('Asia/Seoul'))

def parse_command(text):
    if text.startswith("/"):
        return text.strip().split()[0]
    return ""

def generate_schedule_message():
    return (
        "📅 향후 7일간 주요 일정 (/일정 명령어 예시)\n"
        "\n"
        "날짜 (KST) | 이벤트 | 예상 영향\n"
        "-----------|--------|-------------\n"
        "5월 17일 | 트럼프 대통령의 암호화폐 연설 | 시장에 긍정적 신호 제공 가능성\n"
        "5월 20일 | 연준의 금리 결정 발표 | 시장 변동성 증가 예상\n"
        "5월 22일 | 미국-중국 무역 협상 회담 | 시장 안정성에 영향 가능성\n"
        "5월 25일 | 비트코인 관련 국제 컨퍼런스 | 시장 관심도 증가 예상\n"
        "\n"
        "이러한 일정들은 비트코인 시장에 직접적인 영향을 미칠 수 있으므로, 주의 깊게 관찰하시기 바랍니다."
    )

def generate_btc_report():
    return (
        "📍 [비트코인 12시간 동향 예측 분석]\n"
        "발행 시각: 2025년 5월 16일 오전 9:00 (KST 기준)\n"
        "분석 기준 시세: $10278.50 (Coinbase 기준)\n"
        "━━━━━━━━━━━━━━━━━━━━\n"
        "📌 1. 시장 이벤트 및 뉴스 요약 (중립)\n"
        "- 미국 PPI 발표 결과 예상치 부합 → 시장 영향 제한적\n"
        "- 트럼프 연설 예고(한국시간 오늘 밤 10시) → 단기 변동성 유발 가능성\n"
        "- ETF 승인 루머 재확산 중이나 공식 발표 無\n"
        "🧩 현재 뉴스는 가격 급등/급락을 야기할 수준은 아니나, 주말 전 변동성 확대는 유효.\n"
        "━━━━━━━━━━━━━━━━━━━━\n"
        "📈 2. 기술적 분석 (호재)\n"
        "- RSI: 58.1 (과열 아님, 상승 여력 있음)\n"
        "- MACD: 1H 및 4H 기준 골든크로스 유지\n"
        "- 주요 지지선: $10180 / 주요 저항선: $10400\n"
        "- OBV 상승 중 → 매수세 유입 확인\n"
        "📌 기술적으로는 단기 상승 모멘텀 유지.\n"
        "━━━━━━━━━━━━━━━━━━━━\n"
        "🧠 3. 심리·구조 분석 (중립)\n"
        "- 공포·탐욕지수: 63 (탐욕)\n"
        "- 펀딩비: +0.009% (롱 쏠림 약화)\n"
        "- 거래소 내 미체결 롱 비중 증가 → 고점 저항 주의 필요\n"
        "📌 시장 참여자들의 기대 심리는 높지만, 일부 포지션 청산 주의.\n"
        "━━━━━━━━━━━━━━━━━━━━\n"
        "⏱ 4. 향후 12시간 매매 전망\n"
        "- 🔼 상승 확률: 63%\n"
        "- ➖ 횡보 확률: 24%\n"
        "- 🔽 하락 확률: 13%\n"
        "- 📍 예상 변동 구간: $10250 ~ $10400\n"
        "🎯 이 구간 돌파 여부가 주간 방향성을 결정할 핵심 트리거.\n"
        "━━━━━━━━━━━━━━━━━━━━\n"
        "🚨 5. 예외 상황 감지\n"
        "- 트럼프 연설(한국시간 22시) 및 중국 산업생산 지표(오전 11시) → 변동성 확대 주의\n"
        "━━━━━━━━━━━━━━━━━━━━\n"
        "🔁 6. 이전 예측 검증\n"
        "- 전일 오전 리포트: 상승 확률 70% 제시\n"
        "- 실제 시세: $10160 → $10310 마감 → ✅ 예측 적중\n"
        "━━━━━━━━━━━━━━━━━━━━\n"
        "💰 수익 정보 요약\n"
        "- 금일 실현 손익: +$55.40 (약 7만 6천원)\n"
        "- 미실현 손익: +$78.50 (약 10만 7천원)\n"
        "- 총 수익: +$133.90 (약 18만 3천원)\n"
        "- 총 자산 변화: $2,100.00 → $2,178.50 (+$78.50)\n"
        "━━━━━━━━━━━━━━━━━━━━\n"
        "😌 오늘의 멘탈 코멘트\n"
        "시장에선 느긋한 자가 끝에 웃습니다. 지금 벌고 있으면, 급하지 않아도 됩니다.\n"
        "오늘 수익은 야식 세트 5번 시켜도 남을 정도네요 🍕\n"
        "*성급한 손가락은 수익을 밀어내는 법입니다.*"
    )

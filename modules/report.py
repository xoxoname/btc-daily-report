# modules/report.py

import os
from datetime import datetime
from openai import OpenAI

# âœ… ìµœì‹  ë°©ì‹ìœ¼ë¡œ ìˆ˜ì •
client = OpenAI(
    api_key=os.getenv("OPENAI_API_KEY"),
)

def get_prediction_report():
    prompt = """
ë‹¹ì‹ ì€ ì „ë¬¸ ë¹„íŠ¸ì½”ì¸ ë¶„ì„ê°€ì…ë‹ˆë‹¤. ë‹¤ìŒ ê¸°ì¤€ì— ë”°ë¼ 12ì‹œê°„ ì˜ˆì¸¡ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

1. ğŸ“Š [ì‹œì¥ ì´ë²¤íŠ¸ ìš”ì•½]
- ì˜¤ëŠ˜ ë°œí‘œëœ ë¯¸êµ­ ê²½ì œì§€í‘œ ìš”ì•½ (í˜¸ì¬/ì•…ì¬ êµ¬ë¶„ í¬í•¨)
- ì—°ì¤€ ë°œì–¸ ë° íŠ¸ëŸ¼í”„/ë°”ì´ë“  ì´ìŠˆ ìš”ì•½
- ETF ìŠ¹ì¸, í•´í‚¹ ë“± íŠ¹ì´ ì†ë³´ ì—¬ë¶€ í¬í•¨
- ë¯¸êµ­ ì¦ì‹œ ê°œì¥ ì „ ì£¼ìš” ì‹¤ì  ë°œí‘œ ë° BTC ì˜í–¥ ìš”ì•½

2. ğŸ“ˆ [ê¸°ìˆ ì  ë¶„ì„]
- RSI, MACD, ì´ë™í‰ê· (20/50/200), ë³¼ë¦°ì €ë°´ë“œ, í”¼ë³´ë‚˜ì¹˜, ì´ì¹˜ëª¨ì¿ , ìº”ë“¤íŒ¨í„´ ë“± ì¢…í•©
- íŒŒìƒ: í€ë”©ë¹„, ì˜¤í”ˆì´ì, ë¡±ìˆë¹„ìœ¨, CVD, ìœ ë™ì„±ë§µ

3. ğŸ§  [ì‹¬ë¦¬ ë° êµ¬ì¡°]
- ê³µí¬íƒìš•ì§€ìˆ˜, íŠ¸ìœ„í„°/X ì—¬ë¡ , ìê¸ˆ íë¦„(DXY, ETH/BTC)
- ETF ìœ ì…/ìœ ì¶œ, ì˜µì…˜ ë§Œê¸°/ê¸°ê´€ ë¦¬ë°¸ëŸ°ì‹±

4. ğŸ“Œ [12ì‹œê°„ ì˜ˆì¸¡]
- ìƒìŠ¹/í•˜ë½ í™•ë¥ (%), ê·¼ê±° ê°„ê²° ìš”ì•½, ì „ëµ ì œì‹œ

5. âš ï¸ [ì˜ˆì™¸ ê°ì§€]
- ì˜ˆìƒ ì™¸ ì´ë²¤íŠ¸ ì‹œ ì•Œë¦¼ ì¶”ì²œ ì—¬ë¶€ í¬í•¨

6. ğŸ§¾ [ì˜ˆì¸¡ ê²€ì¦]
- 12ì‹œê°„ ì „ ì˜ˆì¸¡ê³¼ ë¹„êµ, ì˜¤ì°¨ ì›ì¸ ë° ê°œì„  ìš”ì•½

ë¶„ì„ì€ êµ¬ì¡°ì ìœ¼ë¡œ, ê° ì§€í‘œì™€ ì°¨íŠ¸ ê·¼ê±°ë¥¼ í†µí•©í•˜ì—¬ ì‘ì„±í•  ê²ƒ.
    """

    response = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "ë‹¹ì‹ ì€ ì„¸ê³„ ìµœê³ ì˜ í¬ë¦½í†  ì „ëµê°€ì…ë‹ˆë‹¤."},
            {"role": "user", "content": prompt}
        ],
        temperature=0.7
    )
    return response.choices[0].message.content

def format_profit_report_text():
    realized_pnl = 31.4
    unrealized_pnl = -5.2
    entry_asset = 520.0
    total_pnl = realized_pnl + unrealized_pnl
    profit_rate = (total_pnl / entry_asset) * 100

    return f"""\
ğŸ§¾ ì‹¤í˜„ ì†ìµ: ${realized_pnl:.2f}
ğŸ“‰ ë¯¸ì‹¤í˜„ ì†ìµ: ${unrealized_pnl:.2f}
ğŸ’° ì´ ì†ìµ: ${total_pnl:.2f}
ğŸ“ˆ ìˆ˜ìµë¥ : {profit_rate:.2f}%
ğŸ•’ ê¸°ì¤€ ì‹œê°: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
"""
